<?xml version="1.0" encoding="UTF-8" ?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="wordbook">

	<!-- 쿼리문 작성 -->
	
	<select id="selectWordbookAlldirectoryList" resultType="com.javaex.vo.WordbookVo" parameterType="com.javaex.vo.URLPathVo">
		select directoryno, directoryname
			from 
			(select d.directoryname,
			     d.directoryno
			from	directory d, users u
			where u.id = #{URLId}
			and u.userno = d.userno)
		ORDER BY DIRECTORYNO ASC
	</select>
	
	<select id="selectdirectoryWordbookList" resultType="com.javaex.vo.WordbookVo" parameterType="com.javaex.vo.URLPathVo">
	<![CDATA[
		select   u.nickname,
					w.wordbookno,
					w.wordbookname,
					w.wordbookregdate,
					w.wordbookaccess,
					w.wordbookmaker,
					d.directoryno
		from 	wordbook w, directory d, users u
		where 	w.directoryno = d.directoryno
		and 		d.userno = u.userno
		and 		d.directoryno = #{directoryNo}
	]]>
	</select>

	<select id="selectDefaultWordbookList" resultType="com.javaex.vo.WordbookVo" parameterType="com.javaex.vo.URLPathVo">
	<![CDATA[
		select   u.nickname,
					w.wordbookno,
					w.wordbookname,
					w.wordbookregdate,
					w.wordbookaccess,
					w.wordbookmaker,
					d.directoryno
		from 	wordbook w, directory d, users u
		where 	w.directoryno = d.directoryno
		and 		d.userno = u.userno
		and 		d.directoryno = 
						(select 	d.directoryno
						from 	users u,directory d
						where 	u.id=#{URLId}
						and 		u.userno = d.userno
						and 		rownum=1)
	]]>
	</select>
	<delete id="deleteWordbook" parameterType="com.javaex.vo.URLPathVo">
	
		<![CDATA[
		
		delete from 	wordbook 
		where 			wordbookno = #{wordbookNo}
		
		]]>
	
	</delete>
	<delete id="deleteWord" parameterType="com.javaex.vo.URLPathVo">
	
		<![CDATA[
		
		delete from 	word 
		where 			wordbookno = #{wordbookNo}
		
		]]>
	
	</delete>
	<select id="selectOneNickName" resultType="com.javaex.vo.URLPathVo" parameterType="com.javaex.vo.URLPathVo">
	
		select 	nickname,userimage,usercontent
		 from 	users 
		 where 	userno = (select userno 
		 				  from users 
		 				  where id = #{URLId})
	</select>
	
	<!-- 공유하는 구문 -->
	<select id="selectWordbookInfo" resultType="com.javaex.vo.WordbookVo" parameterType="com.javaex.vo.URLPathVo">
		select wordbookname,wordbookregdate,wordbookaccess,wordbookmaker 
		from wordbook 
		where wordbookno=#{wordbookNo}
	</select>
	<select id="selectDirectoryNoInfo" resultType="com.javaex.vo.WordbookVo" parameterType="java.lang.String">
		select 	* 
		from 	 (select 		d.directoryno 
					  from 			directory d, users u
					  where 		u.id = #{id}
					  and  			d.userno = u.userno
					  order by 		d.directoryno asc)
		where 	rownum=1
	</select>
	<select id="selectVocabularyInfo" resultType="com.javaex.vo.VocabularyListVo" parameterType="com.javaex.vo.URLPathVo">
		
		select 	wordname,meanname 
		from 	word 
		where 	word.wordbookno = #{wordbookNo}
	
	</select>


<!-- <selectKey keyProperty="wordbookNo" resultType="int">

			select wordbook_seq.currval as wordbookno from dual

		</selectKey> -->
		<!-- 공유기능 변경을 위한 쿼리문 작성칸 (공유가능으로) -->
		<update id="updateWordbookAccess0" parameterType="com.javaex.vo.URLPathVo">
		
			update  wordbook 
			set 		wordbookaccess = 0 
			where wordbookno = #{wordbookNo}
		
		</update>
		
		<!-- 공유기능 변경을 위한 쿼리문 작성칸 (공유 불가로)-->
		<update id="updateWordbookAccess1" parameterType="com.javaex.vo.URLPathVo">
		
			update  wordbook 
			set 		wordbookaccess = 1 
			where wordbookno = #{wordbookNo}
		
		</update>

</mapper>